<div class="form-container">
    <div class="form-header">
        <div class="header-content">
            <div class="header-icon">
                <i class="bi bi-person-vcard"></i>
            </div>
            <h3>Información Personal</h3>
            <p>Complete los datos </p>
        </div>
    </div>

    <div class="form-content">
        <!-- Selector de tipo de persona -->
        <div class="person-type-selector">
            <div class="type-option" [class.active]="personType === 'NATURAL'">
                <input type="radio" id="natural-person" [(ngModel)]="personType" name="person-type" value="NATURAL" (change)="updateIsNaturalEntity()">
                <label for="natural-person">
                    <div class="option-icon">
                        <i class="bi bi-person"></i>
                    </div>
                    <div class="option-text">
                        <span class="title">Persona Natural</span>
                        <span class="subtitle">Individuo o ciudadano</span>
                    </div>
                </label>
            </div>

            <div class="type-option" [class.active]="personType === 'JURIDIC'">
                <input type="radio" id="juridical-person" [(ngModel)]="personType" name="person-type" value="JURIDIC" (change)="updateIsNaturalEntity()">
                <label for="juridical-person">
                    <div class="option-icon">
                        <i class="bi bi-building"></i>
                    </div>
                    <div class="option-text">
                        <span class="title">Persona Jurídica</span>
                        <span class="subtitle">Empresa u organización</span>
                    </div>
                </label>
            </div>
        </div>

        <!-- Contenido del formulario -->
        <div class="form-fields">
            @if (personType === 'NATURAL') {
                <div class="form-section animate-fade-in">
                    <ng-container *ngTemplateOutlet="naturalPersonTemplate"></ng-container>
                </div>
            } @else if (personType === 'JURIDIC') {
                <div class="form-section animate-fade-in">
                    <ng-container *ngTemplateOutlet="juridicalPersonTemplate"></ng-container>
                </div>
            }
        </div>
    </div>
</div>

<ng-template #naturalPersonTemplate>
    <!-- Documento de identidad con búsqueda -->
    <div class="field-group search-field">
        <label class="field-label">
            <span class="label-text">
                <i class="bi bi-card-text"></i>
                Documento de Identidad
                @if (!isDenounced) {
                    <span class="required">*</span>
                }
            </span>
        </label>
        <div class="search-container">
            <div class="input-with-counter">
                <input 
                    type="text" 
                    id="dni" 
                    name="dni" 
                    placeholder="Ingrese DNI" 
                    pattern="{{ dniPattern }}"
                    minlength="8" maxlength="8" inputmode="numeric"
                    [(ngModel)]="naturalPerson.dni"
                    (input)="onDigitsInput($event, 'dni')"
                    class="form-input">
                <div class="input-counter" [class.invalid]="dniLength > 0 && dniLength !== 8">{{ dniLength }}/8</div>
            </div>
            <button type="button" class="search-btn" (click)="requestInformation()" [disabled]="isLoading || !isIdentifierValid()">
                @if (isLoading) {
                    <i class="bi bi-arrow-clockwise spin"></i>
                    <span>Buscando...</span>
                } @else {
                    <i class="bi bi-search"></i>
                    <span>Buscar</span>
                }
            </button>
        </div>
        <small class="field-error" *ngIf="">El DNI debe tener exactamente 8 dígitos numéricos.</small>
    </div>

    <!-- Nombres -->
    <div class="form-row">
        <div class="field-group">
            <label class="field-label">
                <span class="label-text">
                    <i class="bi bi-person-badge"></i>
                    Nombres
                    @if (!isDenounced) {
                        <span class="required">*</span>
                    }
                </span>
            </label>
            <input 
                type="text" 
                id="name" 
                name="name" 
                pattern="{{ namesPattern }}" 
                placeholder="Nombres completos"
                [(ngModel)]="naturalPerson.name" 
                [disabled]="hasResponseInNatural" 
                class="form-input">
        </div>

        <div class="field-group">
            <label class="field-label">
                <span class="label-text">
                    <i class="bi bi-person-badge"></i>
                    Apellido Paterno
                    @if (!isDenounced) {
                        <span class="required">*</span>
                    }
                </span>
            </label>
            <input 
                type="text" 
                id="paternal-surname" 
                name="paternal-surname" 
                pattern="{{ namesPattern }}"
                placeholder="Apellido paterno" 
                [(ngModel)]="naturalPerson.paternalSurname"
                [disabled]="hasResponseInNatural" 
                class="form-input">
        </div>

        <div class="field-group">
            <label class="field-label">
                <span class="label-text">
                    <i class="bi bi-person-badge"></i>
                    Apellido Materno
                    @if (!isDenounced) {
                        <span class="required">*</span>
                    }
                </span>
            </label>
            <input 
                type="text" 
                id="mother-surname" 
                name="mother-surname" 
                pattern="{{ namesPattern }}"
                placeholder="Apellido materno" 
                [(ngModel)]="naturalPerson.motherSurname"
                [disabled]="hasResponseInNatural" 
                class="form-input">
        </div>
    </div>

    <ng-container *ngTemplateOutlet="sharedInfo"></ng-container>
</ng-template>

<ng-template #juridicalPersonTemplate>
    <!-- RUC con búsqueda -->
    <div class="field-group search-field">
        <label class="field-label">
            <span class="label-text">
                <i class="bi bi-building"></i>
                RUC
                @if (!isDenounced) {
                    <span class="required">*</span>
                }
            </span>
        </label>
        <div class="search-container">
            <div class="input-with-counter">
                <input 
                    type="text" 
                    id="ruc" 
                    name="ruc" 
                    pattern="{{ rucPattern }}" 
                    placeholder="Ingrese RUC"
                    minlength="11" maxlength="11" inputmode="numeric"
                    [(ngModel)]="juridicPerson.ruc"
                    (input)="onDigitsInput($event, 'ruc')"
                    class="form-input">
                <div class="input-counter" [class.invalid]="rucLength > 0 && rucLength !== 11">{{ rucLength }}/11</div>
            </div>
            
            <button type="button" class="search-btn" (click)="requestInformation()" [disabled]="isLoading || !isIdentifierValid()">
                @if (isLoading) {
                    <i class="bi bi-arrow-clockwise spin"></i>
                    <span>Buscando...</span>
                } @else {
                    <i class="bi bi-search"></i>
                    <span>Buscar</span>
                }
            </button>
        </div>
        <small class="field-error" *ngIf="">El RUC debe tener exactamente 11 dígitos numéricos.</small>
    </div>

    <!-- Razón Social -->
    <div class="field-group">
        <label class="field-label">
            <span class="label-text">
                <i class="bi bi-building"></i>
                Razón Social
                @if (!isDenounced) {
                    <span class="required">*</span>
                }
            </span>
        </label>
        <input 
            type="text" 
            id="trade-name" 
            name="trade-name" 
            pattern="{{ tradeNamePattern }}" 
            placeholder="Nombre de la empresa"
            [(ngModel)]="juridicPerson.tradeName" 
            [disabled]="hasResponseInJuridic" 
            class="form-input">
    </div>

    <!-- Representante Legal -->
    <div class="field-group">
        <label class="field-label">
            <span class="label-text">
                <i class="bi bi-person-check"></i>
                Representante Legal
            </span>
        </label>
        <input 
            type="text" 
            id="legal-representator" 
            name="legal-representator" 
            pattern="{{ namesPattern }}"
            placeholder="Nombre del representante legal" 
            [(ngModel)]="person.legalRepresentator" 
            class="form-input">
    </div>

    <ng-container *ngTemplateOutlet="sharedInfo"></ng-container>
</ng-template>

<ng-template #sharedInfo>
    <!-- Dirección -->
    <div class="field-group">
        <label class="field-label">
            <span class="label-text">
                <i class="bi bi-geo-alt"></i>
                Dirección
                @if (!isDenounced) {
                    <span class="required">*</span>
                }
            </span>
        </label>
        <input 
            type="text" 
            id="address" 
            name="address" 
            pattern="{{ addressPattern }}"
            placeholder="Dirección completa" 
            [(ngModel)]="person.address" 
            class="form-input">
    </div>

    <!-- Teléfonos -->
    <div class="form-row">
        <div class="field-group">
            <label class="field-label">
                <span class="label-text">
                    <i class="bi bi-telephone"></i>
                    Teléfono Fijo
                </span>
            </label>

            <div class="input-with-counter">
                <input 
                    type="tel" 
                    id="fixed-phone" 
                    name="fixed-phone" 
                    pattern="{{ fixedPhonePattern }}" 
                    minlength="6" maxlength="6" inputmode="numeric"
                    placeholder="123456"
                    [(ngModel)]="person.fixedPhone"
                    (input)="onPhoneInput($event, 'fixed')"
                    class="form-input">
                <div class="input-counter" [class.invalid]="fixedPhoneLength > 0 && fixedPhoneLength !== 6">{{ fixedPhoneLength }}/6</div>
            </div>
        </div>

        <div class="field-group">
            <label class="field-label">
                <span class="label-text">
                    <i class="bi bi-phone"></i>
                    Celular 1
                    @if (!isDenounced) {
                        <span class="required">*</span>
                    }
                </span>
            </label>

            <div class="input-with-counter">
                <input 
                    type="tel" 
                    id="first-phone" 
                    name="first-phone" 
                    pattern="{{ phonePattern }}" 
                    minlength="9" maxlength="9" inputmode="numeric"
                    placeholder="987654321"
                    [(ngModel)]="person.firstPhone"
                    (input)="onPhoneInput($event, 'first')"
                    class="form-input">
                <div class="input-counter" [class.invalid]="firstPhoneLength > 0 && firstPhoneLength !== 9">{{ firstPhoneLength }}/9</div>
            </div>
        </div>

        <div class="field-group">
            <label class="field-label">
                <span class="label-text">
                    <i class="bi bi-phone"></i>
                    Celular 2
                </span>
            </label>

            <div class="input-with-counter">
                <input 
                    type="tel" 
                    id="second-phone" 
                    name="second-phone" 
                    pattern="{{ phonePattern }}" 
                    minlength="9" maxlength="9" inputmode="numeric"
                    placeholder="123456789"
                    [(ngModel)]="person.secondPhone"
                    (input)="onPhoneInput($event, 'second')"
                    class="form-input">
                <div class="input-counter" [class.invalid]="secondPhoneLength > 0 && secondPhoneLength !== 9">{{ secondPhoneLength }}/9</div>
            </div>
        </div>
    </div>

    <!-- Email -->
    <div class="field-group">
        <label class="field-label">
            <span class="label-text">
                <i class="bi bi-envelope"></i>
                Correo Electrónico
                @if (!isDenounced) {
                    <span class="required">*</span>
                }
            </span>
        </label>
        <input 
            type="email" 
            id="email" 
            name="email" 
            placeholder="correo@ejemplo.com" 
            [(ngModel)]="person.email"
            class="form-input">
    </div>
</ng-template>